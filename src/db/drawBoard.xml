<?xml version="1.0" encoding="UTF-8"?>
<!-- board.xml -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="DrawBoard">	
	<select id="selectAll" resultType="int">
      SELECT COUNT(*) FROM PAGET
   </select>
   <select id="selectList" resultType="drawBoard.PageTDataBean">
      SELECT * FROM PATHT
   </select>   
   <select id="selectOne" parameterType="String" resultType="String">
         SELECT localpath FROM PATHT
   </select>
   <select id="selectPatient" resultType="drawBoard.PatientTDataBean">
         SELECT * FROM PATIENTT
   </select>	
<!--    <select id="selectPath" resultType="drawBoard.PathTDataBean">
         SELECT * FROM PATHT
   </select>  -->
      <select id="selectForm" resultType="drawBoard.FormTDataBean">
         SELECT * FROM FORMT
   </select> 
   <select  id="selectPrescription" resultType="drawBoard.PrescriptionTDataBean"> 
   		SELECT * FROM PRESCRIPTIONT 
   	</select>
   	
   	<select id="selectWait" resultType="drawBoard.WaitDataBean">
   		select a.name, a.patid, b.patid, b.treatno, c.treatno, c.localpath
		from patientt a, treatt b, patht2 c
		where a.patid=b.patid and b.treatno=c.treatno and c.localpath!='#';
   	</select>
   	
   	<select id="selectLogin" resultType="drawBoard.LoginDataBean" parameterType="String">
   		SELECT * FROM USERT WHERE userid=#{id}
   	</select>
   	
   	<select id="selectPatientById" resultType="drawBoard.PatientTDataBean" parameterType="String">
   		SELECT * FROM PATIENTT WHERE patid=#{patId}
   	</select>
   	
   	<select id="selectPatientByName" resultType="drawBoard.PatientTDataBean" parameterType="String">
   		SELECT * FROM PATIENTT WHERE name=#{patName}
   	</select>	
   	<select id="selectTreatNoByPatId" resultType="int" parameterType="String">
   		SELECT TREATNO FROM TREATT WHERE PATID=#{patId}
   	</select>	
   	<select id="selectAllPage" resultType="drawBoard.PageTDataBean">
   		SELECT * FROM PAGET ORDER BY PAGENO DESC
   	</select>	
   	<insert id="insertPageT" parameterType="drawBoard.PageTDataBean">
   		INSERT INTO PAGET(PATHID, CDATE, CUSERID, FILESIZE, EXTENSION) VALUES( #{pathid}, #{cdate}, #{cuserid}, #{filesize}, #{extension})
   	</insert>   	
   	<insert id="insertChartPageT" parameterType="drawBoard.ChartPageTDataBean">
   		INSERT INTO CHARTPAGET(PAGENO, TREATNO, FORMCODE, PAGE, CDNO, SECURITY, UNREADY, CDATE, CUSERID, INSCODE, MEMO) 
   		VALUES( #{pageno}, #{treatno}, #{formcode}, #{page}, #{cdno}, #{security}, #{unready}, #{cdate}, #{cuserid}, #{inscode}, #{memo})
   	</insert> 
   	
   	<select id="selectClinic" parameterType="String" resultType="viewer.PatientFormDataBean">
   		SELECT DISTINCT NAME FROM 
		(SELECT tr.TREATNO, tr.PATID, tr.INDATE, cl.NAME
		FROM TREATT tr, CLINICT cl
		WHERE tr.CLINCODE=cl.CLINCODE AND PATID=#{patId}) A,
		(SELECT ch.PAGENO, ch.TREATNO, ch.FORMCODE, ch.PAGE, fo.NAME AS 'FORMNAME', fo.CLASS, fo.BASEIMGPATH
		FROM CHARTPAGET ch, FORMT fo
		WHERE ch.FORMCODE = fo.FORMCODE) B
		WHERE A.TREATNO = B.TREATNO
   	</select>
   	
   	<select id="selectIndate" parameterType="String" resultType="viewer.PatientFormDataBean">
	   	SELECT DISTINCT INDATE, NAME FROM 
		(SELECT tr.TREATNO, tr.PATID, tr.INDATE, cl.NAME
		FROM TREATT tr, CLINICT cl
		WHERE tr.CLINCODE=cl.CLINCODE AND PATID=#{patId}) A,
		(SELECT ch.PAGENO, ch.TREATNO, ch.FORMCODE, ch.PAGE, fo.NAME AS 'FORMNAME', fo.CLASS, fo.BASEIMGPATH
		FROM CHARTPAGET ch, FORMT fo
		WHERE ch.FORMCODE = fo.FORMCODE) B
		WHERE A.TREATNO = B.TREATNO
   	</select>
   	
   	<select id="selectAllForm" parameterType="String" resultType="viewer.PatientFormDataBean">
	   	SELECT *  FROM 
		(SELECT tr.TREATNO, tr.PATID, tr.INDATE, cl.NAME
		FROM TREATT tr, CLINICT cl
		WHERE tr.CLINCODE=cl.CLINCODE AND PATID=#{patId}) A,
		(SELECT ch.PAGENO, ch.TREATNO, ch.FORMCODE, ch.PAGE, fo.NAME AS 'FORMNAME', fo.CLASS, fo.BASEIMGPATH
		FROM CHARTPAGET ch, FORMT fo
		WHERE ch.FORMCODE = fo.FORMCODE) B
		WHERE A.TREATNO = B.TREATNO   		
   	</select>
   	<select resultType="drawBoard.ChartPageTDataBean" id="selectChartpage" parameterType="String"> 
	   	SELECT b.patid, c.patid, c.treatno, a.treatno, a.memo 
	   	FROM CHARTPAGET a, PATIENTT b, TREATT c 
	   	WHERE b.patid=c.patid AND c.treatno=a.treatno AND b.patid=#{patid} AND a.memo!='NULL'
	</select>	
   	<select resultType="drawBoard.UserFormDataBean" id="selectUserform" parameterType="String"> 
	   	SELECT a.NAME, a.ORDERBY, a.BASEIMGPATH, a.FORMCODE, c.FORMCODE, b.USERID, c.USERID 
	   	FROM FORMT a, USERT b, SORTUSERTABLETFORM c 
	   	WHERE a.FORMCODE=c.FORMCODE AND b.USERID=c.USERID AND b.USERID=#{userId} 
	</select>
   	  	
</mapper>


